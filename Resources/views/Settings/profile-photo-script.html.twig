{# TODO: Extract this to an external file #}
<script>
    (function ($) {
        var uploadKey = 'profile_photo';
        var uploadUrl = '{{ path('warble_media_phoenix_settings_profile_photo') }}';

        var input = $('#profile_photo_input');
        var preview = $('#profile_photo_preview');

        input.on('change', function () {
            // Get selected file
            var file = input[0].files[0];

            // Update preview
            var previewReader = new FileReader();
            previewReader.onload = function (e) {
                preview.attr('src', e.target.result);
            };
            previewReader.readAsDataURL(file);

            // Upload file to the server
            var formData = new FormData();
            formData.append(uploadKey, file);

            var xhr = new XMLHttpRequest();
            xhr.open('POST', uploadUrl, true);
            xhr.onreadystatechange = function () {
                console.log({readyState: xhr.readyState, status: xhr.status});
                if (xhr.readyState == 4 && xhr.status == 200) {
                    // TODO: Handle response
                }
            };
            xhr.send(formData);
        });
    })(jQuery);
</script>
